# HeartSpeak AI - Complete Feature Architecture

> AI-powered communication platform for speech-impaired individuals

---

## Table of Contents

1. [AI API Strategy (GPT vs Gemini)](#ai-api-strategy)
2. [Feature 1: Visual Emotion Recognition Video Call](#feature-1-visual-emotion-recognition-video-call)
3. [Feature 2: Pattern-Based Emotional Language](#feature-2-pattern-based-emotional-language)
4. [Feature 3: Heart-to-Heart Chat System](#feature-3-heart-to-heart-chat-system)
5. [Feature 4: Personal Emotion Avatar](#feature-4-personal-emotion-avatar)
6. [Complete Tech Stack](#complete-tech-stack)
7. [Unified Folder Architecture](#unified-folder-architecture)

---

## AI API Strategy

### When to Use Each API

| Use Case | Best API | Reasoning |
|----------|----------|-----------|
| **Real-time video frame analysis** | ğŸŸ¦ Gemini 3 Flash | Fast, cost-effective, excellent multimodal |
| **Pattern/drawing recognition** | ğŸŸ¦ Gemini 3 Flash | Superior visual understanding |
| **Complex emotion text generation** | ğŸŸ© GPT-4o | More nuanced, empathetic writing |
| **Personal avatar conversations** | ğŸŸ© GPT-4o | Better personality consistency |
| **Quick emotion classification** | ğŸŸ¦ Gemini Flash | Low latency, structured output |
| **Learning user patterns (training)** | ğŸŸ¦ Gemini | Better for structured data analysis |
| **Creative emotional expression** | ğŸŸ© GPT-4o | Superior creative writing |
| **Batch image processing** | ğŸŸ¦ Gemini | Cost-effective for volume |

### API Cost Optimization Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      REQUEST ROUTING LOGIC                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Incoming Request                                               â”‚
â”‚       â”‚                                                         â”‚
â”‚       â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    YES    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Has Image/  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  ğŸŸ¦ GEMINI       â”‚                â”‚
â”‚  â”‚ Video Frame?â”‚           â”‚  (Vision tasks)  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚       â”‚ NO                                                      â”‚
â”‚       â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    YES    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Needs High  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  ğŸŸ© GPT-4o       â”‚                â”‚
â”‚  â”‚ Creativity? â”‚           â”‚  (Rich text gen) â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚       â”‚ NO                                                      â”‚
â”‚       â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    YES    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Simple      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  ğŸŸ¦ GEMINI FLASH â”‚                â”‚
â”‚  â”‚ Task?       â”‚           â”‚  (Fast & cheap)  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Feature 1: Visual Emotion Recognition Video Call

### Overview
Real-time video calling platform where facial expressions and gestures are analyzed and converted to emotional text for the other participant.

### Pipeline Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           VIDEO CALL PIPELINE                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   USER A                                                          USER B
     â”‚                                                               â”‚
     â–¼                                                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Camera  â”‚                                                     â”‚ Camera  â”‚
â”‚  Feed   â”‚                                                     â”‚  Feed   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                                                               â”‚
     â–¼                                                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         WebRTC P2P              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Next.js App    â”‚â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¶â”‚  Next.js App    â”‚
â”‚  - Display B    â”‚         Video Stream            â”‚  - Display A    â”‚
â”‚  - Capture Self â”‚                                 â”‚  - Capture Self â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                                   â”‚
         â”‚ Screenshot every 2-3s                             â”‚ Screenshot every 2-3s
         â”‚                                                   â”‚
         â–¼                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          NODE.JS SIGNALING SERVER                           â”‚
â”‚                                                                             â”‚
â”‚   â€¢ WebRTC Signaling (ICE candidates, SDP exchange)                        â”‚
â”‚   â€¢ Call invitation/acceptance handling                                     â”‚
â”‚   â€¢ Route emotion text between users via Socket.io                         â”‚
â”‚   â€¢ Session management                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Forward frames
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PYTHON AI SERVICE (FastAPI + LangChain)                 â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   STEP 1        â”‚    â”‚   STEP 2        â”‚    â”‚   STEP 3                â”‚ â”‚
â”‚  â”‚   MediaPipe     â”‚â”€â”€â”€â–¶â”‚   ğŸŸ¦ GEMINI     â”‚â”€â”€â”€â–¶â”‚   Response              â”‚ â”‚
â”‚  â”‚   Preprocessing â”‚    â”‚   Vision        â”‚    â”‚   Generation            â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚   Analysis      â”‚    â”‚                         â”‚ â”‚
â”‚  â”‚  â€¢ Face mesh    â”‚    â”‚                 â”‚    â”‚  â€¢ Natural language     â”‚ â”‚
â”‚  â”‚  â€¢ Landmarks    â”‚    â”‚  â€¢ Micro-       â”‚    â”‚  â€¢ Contextual (memory)  â”‚ â”‚
â”‚  â”‚  â€¢ Head pose    â”‚    â”‚    expressions  â”‚    â”‚  â€¢ Empathetic tone      â”‚ â”‚
â”‚  â”‚  â€¢ Hand gesture â”‚    â”‚  â€¢ Emotion      â”‚    â”‚                         â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚    nuances      â”‚    â”‚  "They seem to be       â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚  â€¢ Context      â”‚    â”‚   feeling hopeful..."   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    LANGCHAIN MEMORY SYSTEM                           â”‚   â”‚
â”‚  â”‚   â€¢ ConversationBufferWindowMemory (last 10 interactions)           â”‚   â”‚
â”‚  â”‚   â€¢ Session-based context (what emotions were shown before)         â”‚   â”‚
â”‚  â”‚   â€¢ Relationship context (if users have history)                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Emotion text
                                    â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚  Socket.io      â”‚
                           â”‚  Broadcast to   â”‚
                           â”‚  Other User     â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Usage for Feature 1

| Step | API | Input | Output |
|------|-----|-------|--------|
| Frame Analysis | ğŸŸ¦ **Gemini 3 Flash** | Base64 image | Emotion JSON |
| Text Generation | ğŸŸ¦ **Gemini 3 Flash** | Emotion JSON + Context | Natural text |

**Why Gemini for this feature:**
- Real-time requirement (low latency)
- High volume (frames every 2-3 seconds)
- Native multimodal (no separate vision API needed)
- Cost-effective for continuous analysis

### Data Models

```typescript
// Call Session
interface CallSession {
  id: string;
  participants: [string, string];  // User IDs
  status: 'pending' | 'active' | 'ended';
  startedAt?: Date;
  endedAt?: Date;
  emotionHistory: EmotionLog[];
}

// Emotion Log
interface EmotionLog {
  userId: string;
  timestamp: Date;
  detectedEmotions: string[];
  generatedText: string;
  confidence: number;
}
```

---

## Feature 2: Pattern-Based Emotional Language

### Overview
Users create visual patterns (drawings, colors, shapes) that represent their emotions. AI learns these personal associations and can interpret patterns in conversations.

### Pipeline Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PATTERN CREATION PIPELINE                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           NEXT.JS FRONTEND                                  â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                      PATTERN CREATOR CANVAS                          â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚   â”‚   â”‚  Drawing  â”‚  â”‚  Color    â”‚  â”‚  Shape    â”‚  â”‚  Pattern  â”‚        â”‚  â”‚
â”‚   â”‚   â”‚  Tools    â”‚  â”‚  Picker   â”‚  â”‚  Library  â”‚  â”‚  Templatesâ”‚        â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚   â”‚   â”‚                    <canvas> Element                          â”‚   â”‚  â”‚
â”‚   â”‚   â”‚                                                              â”‚   â”‚  â”‚
â”‚   â”‚   â”‚         User draws spiral pattern                            â”‚   â”‚  â”‚
â”‚   â”‚   â”‚              ğŸŒ€                                              â”‚   â”‚  â”‚
â”‚   â”‚   â”‚                                                              â”‚   â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚   â”‚   â”‚  EMOTION ASSOCIATION                                         â”‚   â”‚  â”‚
â”‚   â”‚   â”‚  "This pattern means: [    confusion    â–¼]"                  â”‚   â”‚  â”‚
â”‚   â”‚   â”‚  Intensity: [â”â”â”â”â”â”â”â—â”â”â”] 70%                                â”‚   â”‚  â”‚
â”‚   â”‚   â”‚  Tags: #thinking #processing #uncertain                      â”‚   â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Save Pattern
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          NODE.JS BACKEND                                    â”‚
â”‚                                                                             â”‚
â”‚   POST /api/v1/patterns                                                     â”‚
â”‚   {                                                                         â”‚
â”‚     "imageData": "base64...",                                              â”‚
â”‚     "emotion": "confusion",                                                 â”‚
â”‚     "intensity": 0.7,                                                       â”‚
â”‚     "tags": ["thinking", "processing"],                                    â”‚
â”‚     "colorPalette": ["#3B82F6", "#1E40AF"]                                 â”‚
â”‚   }                                                                         â”‚
â”‚                                                                             â”‚
â”‚   â€¢ Store pattern in MongoDB                                                â”‚
â”‚   â€¢ Upload image to Cloudinary                                              â”‚
â”‚   â€¢ Trigger AI analysis                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PYTHON AI SERVICE                                       â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                    PATTERN ANALYSIS                                  â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   ğŸŸ¦ GEMINI 3 FLASH (Vision)                                        â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚   â”‚   â”‚  Analyze pattern characteristics:                            â”‚   â”‚  â”‚
â”‚   â”‚   â”‚  â€¢ Shape type (spiral, angular, flowing, chaotic)           â”‚   â”‚  â”‚
â”‚   â”‚   â”‚  â€¢ Color psychology (warm, cool, vibrant, muted)            â”‚   â”‚  â”‚
â”‚   â”‚   â”‚  â€¢ Line quality (smooth, jagged, continuous, broken)        â”‚   â”‚  â”‚
â”‚   â”‚   â”‚  â€¢ Density and space usage                                   â”‚   â”‚  â”‚
â”‚   â”‚   â”‚  â€¢ Symmetry and balance                                      â”‚   â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚   â”‚                              â”‚                                       â”‚  â”‚
â”‚   â”‚                              â–¼                                       â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚   â”‚   â”‚  Generate embedding vector for pattern similarity search     â”‚   â”‚  â”‚
â”‚   â”‚   â”‚  Store: { patternId, userId, features, embedding }          â”‚   â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PATTERN INTERPRETATION PIPELINE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  User sends pattern in chat
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PYTHON AI SERVICE                                       â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚   â”‚  STEP 1            â”‚     â”‚  STEP 2            â”‚                        â”‚
â”‚   â”‚  ğŸŸ¦ GEMINI FLASH   â”‚â”€â”€â”€â”€â–¶â”‚  Pattern Matching  â”‚                        â”‚
â”‚   â”‚                    â”‚     â”‚                    â”‚                        â”‚
â”‚   â”‚  Extract visual    â”‚     â”‚  Compare with      â”‚                        â”‚
â”‚   â”‚  features from     â”‚     â”‚  user's saved      â”‚                        â”‚
â”‚   â”‚  received pattern  â”‚     â”‚  pattern library   â”‚                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                       â”‚                                     â”‚
â”‚                                       â–¼                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  STEP 3: ğŸŸ© GPT-4o                                                   â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚  Generate rich interpretation:                                        â”‚  â”‚
â”‚   â”‚  "Alex sent you a spiral pattern in deep blue tones.                 â”‚  â”‚
â”‚   â”‚   Based on their personal pattern language, this represents          â”‚  â”‚
â”‚   â”‚   deep contemplation with a touch of melancholy. They might          â”‚  â”‚
â”‚   â”‚   be processing something complex and want you to know               â”‚  â”‚
â”‚   â”‚   they're thinking deeply about it."                                 â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Usage for Feature 2

| Step | API | Reasoning |
|------|-----|-----------|
| Pattern Feature Extraction | ğŸŸ¦ **Gemini 3 Flash** | Superior visual understanding |
| Generate Embeddings | ğŸŸ¦ **Gemini** | Structured output |
| Rich Interpretation Text | ğŸŸ© **GPT-4o** | Creative, empathetic writing |

### Data Models

```typescript
// User Pattern
interface UserPattern {
  id: string;
  userId: string;
  imageUrl: string;
  emotion: string;
  intensity: number;
  tags: string[];
  colorPalette: string[];
  features: PatternFeatures;
  embedding: number[];  // For similarity search
  createdAt: Date;
}

interface PatternFeatures {
  shapeType: 'spiral' | 'angular' | 'flowing' | 'geometric' | 'chaotic' | 'organic';
  colorMood: 'warm' | 'cool' | 'vibrant' | 'muted' | 'monochrome';
  lineQuality: 'smooth' | 'jagged' | 'continuous' | 'broken';
  density: number;  // 0-1
  symmetry: number; // 0-1
}
```

---

## Feature 3: Heart-to-Heart Chat System

### Overview
Emotion-first messaging where users select emotions, intensity, and context, then AI generates natural conversational text.

### Pipeline Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EMOTION CHAT PIPELINE                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           NEXT.JS FRONTEND                                  â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                    EMOTION COMPOSER                                  â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚  â”‚
â”‚   â”‚   â•‘  STEP 1: Select Primary Emotion                                â•‘ â”‚  â”‚
â”‚   â”‚   â•‘                                                                 â•‘ â”‚  â”‚
â”‚   â”‚   â•‘   ğŸ˜Š Joy    ğŸ˜¢ Sadness   ğŸ˜° Anxiety   â¤ï¸ Love   ğŸ˜¤ Frustration â•‘ â”‚  â”‚
â”‚   â”‚   â•‘   ğŸ¤” Curious  ğŸ˜Œ Peaceful  ğŸ˜” Lonely   ğŸ¥° Grateful  ğŸ˜¶ Neutral â•‘ â”‚  â”‚
â”‚   â”‚   â•‘                                                                 â•‘ â”‚  â”‚
â”‚   â”‚   â•‘  Selected: [ğŸ¥° Grateful]                                        â•‘ â”‚  â”‚
â”‚   â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚  â”‚
â”‚   â”‚   â•‘  STEP 2: Intensity                                             â•‘ â”‚  â”‚
â”‚   â”‚   â•‘                                                                 â•‘ â”‚  â”‚
â”‚   â”‚   â•‘   Subtle [â”â”â—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”] Overwhelming                  â•‘ â”‚  â”‚
â”‚   â”‚   â•‘                     35%                                         â•‘ â”‚  â”‚
â”‚   â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚  â”‚
â”‚   â”‚   â•‘  STEP 3: Add Layers (Optional)                                 â•‘ â”‚  â”‚
â”‚   â”‚   â•‘                                                                 â•‘ â”‚  â”‚
â”‚   â”‚   â•‘   [+] Secondary Emotion:  ğŸ˜¢ Nostalgic (mild)                  â•‘ â”‚  â”‚
â”‚   â”‚   â•‘   [+] Body Sensation:     warmth in chest                      â•‘ â”‚  â”‚
â”‚   â”‚   â•‘   [+] Memory Link:        "thinking of old times"              â•‘ â”‚  â”‚
â”‚   â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚  â”‚
â”‚   â”‚   â•‘  STEP 4: Visual Style                                          â•‘ â”‚  â”‚
â”‚   â”‚   â•‘                                                                 â•‘ â”‚  â”‚
â”‚   â”‚   â•‘   ğŸ¨ Auto-generated emotion gradient                           â•‘ â”‚  â”‚
â”‚   â”‚   â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘ â”‚  â”‚
â”‚   â”‚   â•‘   â”‚  â–‘â–‘â–‘â–“â–“â–“â–ˆâ–ˆâ–ˆ  Warm amber fading to soft rose              â”‚ â•‘ â”‚  â”‚
â”‚   â”‚   â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘ â”‚  â”‚
â”‚   â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚                        [ ğŸ’¬ Send Feeling ]                           â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Emotion Payload
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          NODE.JS BACKEND                                    â”‚
â”‚                                                                             â”‚
â”‚   Receive emotion composition:                                              â”‚
â”‚   {                                                                         â”‚
â”‚     "recipientId": "user_123",                                             â”‚
â”‚     "primary": { "emotion": "grateful", "intensity": 0.35 },               â”‚
â”‚     "secondary": { "emotion": "nostalgic", "intensity": 0.2 },             â”‚
â”‚     "bodySensation": "warmth in chest",                                    â”‚
â”‚     "memoryContext": "thinking of old times",                              â”‚
â”‚     "visualStyle": { "colors": ["#F59E0B", "#EC4899"], "type": "gradient" }â”‚
â”‚   }                                                                         â”‚
â”‚                                                                             â”‚
â”‚   â€¢ Forward to AI Service for text generation                               â”‚
â”‚   â€¢ Store message with emotion metadata                                     â”‚
â”‚   â€¢ Send via Socket.io to recipient                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PYTHON AI SERVICE                                       â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   ğŸŸ© GPT-4o  (Primary for this feature)                              â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   SYSTEM PROMPT:                                                      â”‚  â”‚
â”‚   â”‚   "You are an empathetic emotion translator. Convert emotion         â”‚  â”‚
â”‚   â”‚    selections into natural, heartfelt messages. Maintain the         â”‚  â”‚
â”‚   â”‚    user's authentic voice while enriching their emotional            â”‚  â”‚
â”‚   â”‚    expression. Consider relationship context and conversation        â”‚  â”‚
â”‚   â”‚    history."                                                          â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   INPUT:                                                              â”‚  â”‚
â”‚   â”‚   - Primary: grateful (35% intensity)                                â”‚  â”‚
â”‚   â”‚   - Secondary: nostalgic (mild)                                      â”‚  â”‚
â”‚   â”‚   - Sensation: warmth in chest                                       â”‚  â”‚
â”‚   â”‚   - Context: thinking of old times                                   â”‚  â”‚
â”‚   â”‚   - Relationship: close friend, 2 years                              â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   OUTPUT:                                                             â”‚  â”‚
â”‚   â”‚   "I've been feeling quietly grateful today, and it's bringing       â”‚  â”‚
â”‚   â”‚    back warm memories of the times we've shared. There's this        â”‚  â”‚
â”‚   â”‚    gentle warmth I can't quite explain. You mean a lot to me."       â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ALTERNATIVE OUTPUTS (User can pick)                                 â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚  Option 1: "Feeling thankful for you today. Old memories surfaced." â”‚  â”‚
â”‚   â”‚  Option 2: "Something about today made me think of us, warmly."     â”‚  â”‚
â”‚   â”‚  Option 3: [Generated above - more elaborate]                       â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚  Generate variations: ğŸŸ¦ GEMINI FLASH (faster, cheaper for options)  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      RECIPIENT RECEIVES                                     â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   From: Alex                                          2:34 PM        â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚   â”‚   â”‚  â–‘â–‘â–‘â–“â–“â–“â–ˆâ–ˆâ–ˆ  [Visual gradient header]                        â”‚   â”‚  â”‚
â”‚   â”‚   â”‚                                                              â”‚   â”‚  â”‚
â”‚   â”‚   â”‚  "I've been feeling quietly grateful today, and it's        â”‚   â”‚  â”‚
â”‚   â”‚   â”‚   bringing back warm memories of the times we've shared.    â”‚   â”‚  â”‚
â”‚   â”‚   â”‚   There's this gentle warmth I can't quite explain.         â”‚   â”‚  â”‚
â”‚   â”‚   â”‚   You mean a lot to me."                                    â”‚   â”‚  â”‚
â”‚   â”‚   â”‚                                                              â”‚   â”‚  â”‚
â”‚   â”‚   â”‚  ğŸ¥° Grateful (subtle) + ğŸ˜¢ Nostalgic                        â”‚   â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   [ â¤ï¸ Resonate ]  [ ğŸ’¬ Reply with Emotion ]                         â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Usage for Feature 3

| Step | API | Reasoning |
|------|-----|-----------|
| Primary Text Generation | ğŸŸ© **GPT-4o** | Best emotional nuance & creativity |
| Alternative Options | ğŸŸ¦ **Gemini Flash** | Fast, cheap for variations |
| Emotion Color Mapping | ğŸŸ¦ **Gemini Flash** | Structured JSON output |

### Data Models

```typescript
// Emotion Message
interface EmotionMessage {
  id: string;
  senderId: string;
  recipientId: string;
  conversationId: string;
  
  emotionComposition: {
    primary: { emotion: string; intensity: number };
    secondary?: { emotion: string; intensity: number };
    bodySensation?: string;
    memoryContext?: string;
  };
  
  generatedText: string;
  alternativeTexts?: string[];
  selectedTextIndex: number;
  
  visualStyle: {
    colors: string[];
    type: 'gradient' | 'pattern' | 'solid';
    patternId?: string;  // If using saved pattern
  };
  
  recipientReaction?: {
    resonated: boolean;
    reactionEmoji?: string;
    timestamp: Date;
  };
  
  createdAt: Date;
}

// Emotion Library (System + User Custom)
interface EmotionDefinition {
  id: string;
  name: string;
  emoji: string;
  category: 'joy' | 'sadness' | 'fear' | 'anger' | 'surprise' | 'love' | 'complex';
  colorPalette: string[];
  description: string;
  isCustom: boolean;
  userId?: string;  // If custom emotion
}
```

---

## Feature 4: Personal Emotion Avatar

### Overview
An AI companion that learns the user's unique emotional patterns, communication style, and preferences. Acts as their "emotional voice" and can suggest expressions.

### Pipeline Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AVATAR LEARNING PIPELINE                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATA COLLECTION (Continuous)                             â”‚
â”‚                                                                             â”‚
â”‚   From Feature 1 (Video Calls):                                             â”‚
â”‚   â€¢ Facial expression patterns during calls                                 â”‚
â”‚   â€¢ Which emotions user shows most frequently                               â”‚
â”‚   â€¢ Emotional responses to different conversation topics                    â”‚
â”‚                                                                             â”‚
â”‚   From Feature 2 (Patterns):                                                â”‚
â”‚   â€¢ Personal pattern-emotion associations                                   â”‚
â”‚   â€¢ Color preferences for different moods                                   â”‚
â”‚   â€¢ Drawing style characteristics                                           â”‚
â”‚                                                                             â”‚
â”‚   From Feature 3 (Chat):                                                    â”‚
â”‚   â€¢ Which generated text options user selects                               â”‚
â”‚   â€¢ Emotion combinations used frequently                                    â”‚
â”‚   â€¢ Communication style preferences (elaborate vs concise)                  â”‚
â”‚   â€¢ Relationship-specific patterns (formal with some, casual with others)  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PYTHON AI SERVICE - AVATAR TRAINING                     â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                    PROFILE BUILDER                                   â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   ğŸŸ¦ GEMINI 3 FLASH (Analysis)                                       â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   Analyze user's historical data to build:                           â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   emotional_profile = {                                              â”‚  â”‚
â”‚   â”‚     "dominant_emotions": ["hopeful", "gentle_concern", "warmth"],    â”‚  â”‚
â”‚   â”‚     "expression_style": "poetic_understated",                        â”‚  â”‚
â”‚   â”‚     "intensity_preference": 0.4,  // Tends toward subtle             â”‚  â”‚
â”‚   â”‚     "vocabulary_level": "intermediate",                              â”‚  â”‚
â”‚   â”‚     "cultural_context": "south_asian",                               â”‚  â”‚
â”‚   â”‚     "relationship_adaptations": {                                    â”‚  â”‚
â”‚   â”‚       "close_friends": { "style": "warm_casual", "emoji_use": high },â”‚  â”‚
â”‚   â”‚       "family": { "style": "respectful_loving", "emoji_use": low },  â”‚  â”‚
â”‚   â”‚       "acquaintances": { "style": "polite_reserved" }                â”‚  â”‚
â”‚   â”‚     },                                                                â”‚  â”‚
â”‚   â”‚     "trigger_patterns": [                                            â”‚  â”‚
â”‚   â”‚       { "context": "late_night", "likely_emotion": "reflective" },   â”‚  â”‚
â”‚   â”‚       { "context": "achievement", "likely_emotion": "humble_joy" }   â”‚  â”‚
â”‚   â”‚     ]                                                                 â”‚  â”‚
â”‚   â”‚   }                                                                   â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AVATAR INTERACTION PIPELINE                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           NEXT.JS FRONTEND                                  â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                    AVATAR INTERFACE                                  â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚   â”‚   â”‚         ğŸ¤– Your Emotion Avatar                               â”‚   â”‚  â”‚
â”‚   â”‚   â”‚         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚   â”‚  â”‚
â”‚   â”‚   â”‚                                                              â”‚   â”‚  â”‚
â”‚   â”‚   â”‚   "I notice you've been showing gentle concern in your      â”‚   â”‚  â”‚
â”‚   â”‚   â”‚    recent calls. Would you like me to help express          â”‚   â”‚  â”‚
â”‚   â”‚   â”‚    what's on your mind to Sarah?"                           â”‚   â”‚  â”‚
â”‚   â”‚   â”‚                                                              â”‚   â”‚  â”‚
â”‚   â”‚   â”‚   [ Yes, help me express this ]  [ Not now ]                â”‚   â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚   â”‚   â”‚   AVATAR SUGGESTIONS                                         â”‚   â”‚  â”‚
â”‚   â”‚   â”‚                                                              â”‚   â”‚  â”‚
â”‚   â”‚   â”‚   Based on your patterns, you might want to say:            â”‚   â”‚  â”‚
â”‚   â”‚   â”‚                                                              â”‚   â”‚  â”‚
â”‚   â”‚   â”‚   ğŸ’­ "I've been thinking about you. Is everything okay?"    â”‚   â”‚  â”‚
â”‚   â”‚   â”‚   ğŸ’­ "I sense something's different. I'm here if needed."   â”‚   â”‚  â”‚
â”‚   â”‚   â”‚   ğŸ’­ [Suggest a pattern to send instead]                    â”‚   â”‚  â”‚
â”‚   â”‚   â”‚                                                              â”‚   â”‚  â”‚
â”‚   â”‚   â”‚   [ Use this ]  [ Modify ]  [ Show more options ]           â”‚   â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ User interaction
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PYTHON AI SERVICE - AVATAR AGENT                        â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                    LANGCHAIN AVATAR AGENT                            â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   ğŸŸ© GPT-4o (Primary - Best for personality consistency)             â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   SYSTEM PROMPT (Personalized per user):                             â”‚  â”‚
â”‚   â”‚   """                                                                 â”‚  â”‚
â”‚   â”‚   You are {user_name}'s personal emotion avatar. You understand      â”‚  â”‚
â”‚   â”‚   their unique way of expressing feelings.                           â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   Their profile:                                                      â”‚  â”‚
â”‚   â”‚   - Expression style: {poetic_understated}                           â”‚  â”‚
â”‚   â”‚   - Dominant emotions: {hopeful, gentle_concern, warmth}             â”‚  â”‚
â”‚   â”‚   - They prefer subtle intensity (around 40%)                        â”‚  â”‚
â”‚   â”‚   - With close friends, they're warm and casual                      â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   Current context:                                                    â”‚  â”‚
â”‚   â”‚   - Talking to: Sarah (close friend)                                 â”‚  â”‚
â”‚   â”‚   - Recent pattern: showing gentle concern in calls                  â”‚  â”‚
â”‚   â”‚   - Time: late evening (they tend to be reflective)                  â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   Suggest expressions that sound authentically like them,            â”‚  â”‚
â”‚   â”‚   not generic AI responses.                                          â”‚  â”‚
â”‚   â”‚   """                                                                 â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                    MEMORY SYSTEM                                     â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   LangChain Memory Components:                                       â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   â€¢ ConversationSummaryMemory - Long-term relationship context      â”‚  â”‚
â”‚   â”‚   â€¢ EntityMemory - Remember specific people and past interactions   â”‚  â”‚
â”‚   â”‚   â€¢ VectorStoreMemory - Semantic search through past expressions    â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   Storage: Redis (session) + MongoDB (permanent)                    â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PROACTIVE AVATAR FEATURES                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  1. EMOTION DETECTION ASSIST                                            â”‚
  â”‚                                                                         â”‚
  â”‚  When user seems stuck or unsure:                                       â”‚
  â”‚  Avatar: "I see you're hovering between 'worried' and 'hopeful'.       â”‚
  â”‚          That sounds like cautious optimism. Would that fit?"          â”‚
  â”‚                                                                         â”‚
  â”‚  API: ğŸŸ¦ GEMINI FLASH (quick classification assist)                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  2. RELATIONSHIP INSIGHTS                                               â”‚
  â”‚                                                                         â”‚
  â”‚  Avatar: "You haven't connected with Mom in 2 weeks. Based on your     â”‚
  â”‚          patterns, you usually feel closer after reaching out.         â”‚
  â”‚          Want me to help compose something?"                           â”‚
  â”‚                                                                         â”‚
  â”‚  API: ğŸŸ¦ GEMINI (analysis) â†’ ğŸŸ© GPT-4o (suggestion)                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  3. EMOTIONAL CHECK-INS                                                 â”‚
  â”‚                                                                         â”‚
  â”‚  Periodic prompts based on patterns:                                    â”‚
  â”‚  Avatar: "It's been a reflective week. Want to capture how you're      â”‚
  â”‚          feeling in a pattern or send a thought to someone?"           â”‚
  â”‚                                                                         â”‚
  â”‚  API: ğŸŸ¦ GEMINI FLASH (timing/trigger logic)                           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Usage for Feature 4

| Step | API | Reasoning |
|------|-----|-----------|
| Profile Analysis | ğŸŸ¦ **Gemini 3 Flash** | Complex data analysis |
| Avatar Conversations | ğŸŸ© **GPT-4o** | Personality consistency |
| Quick Suggestions | ğŸŸ¦ **Gemini Flash** | Low latency |
| Relationship Insights | ğŸŸ¦ **Gemini** â†’ ğŸŸ© **GPT-4o** | Analysis then generation |

### Data Models

```typescript
// User Avatar Profile
interface AvatarProfile {
  userId: string;
  
  emotionalProfile: {
    dominantEmotions: string[];
    expressionStyle: 'poetic' | 'direct' | 'understated' | 'elaborate';
    intensityPreference: number;
    vocabularyLevel: 'simple' | 'intermediate' | 'advanced';
    culturalContext?: string;
  };
  
  relationshipAdaptations: {
    [contactId: string]: {
      relationshipType: string;
      style: string;
      emojiUse: 'high' | 'medium' | 'low';
      customNotes?: string;
    };
  };
  
  triggerPatterns: {
    context: string;
    likelyEmotion: string;
    confidence: number;
  }[];
  
  learningData: {
    totalInteractions: number;
    lastUpdated: Date;
    feedbackScore: number;  // How often user accepts suggestions
  };
  
  updatedAt: Date;
}

// Avatar Interaction Log
interface AvatarInteraction {
  id: string;
  userId: string;
  type: 'suggestion' | 'assist' | 'check_in' | 'insight';
  context: string;
  suggestion: string;
  userAction: 'accepted' | 'modified' | 'rejected' | 'ignored';
  modifiedText?: string;  // If user modified suggestion
  timestamp: Date;
}
```

---

## Complete Tech Stack

### Frontend (Next.js 14+)

```
Dependencies:
â”œâ”€â”€ Core
â”‚   â”œâ”€â”€ next@14.x                    # React framework
â”‚   â”œâ”€â”€ react@18.x                   # UI library
â”‚   â””â”€â”€ typescript                   # Type safety
â”‚
â”œâ”€â”€ Styling & UI
â”‚   â”œâ”€â”€ tailwindcss                  # Utility CSS
â”‚   â”œâ”€â”€ @radix-ui/*                  # Accessible primitives
â”‚   â”œâ”€â”€ shadcn/ui                    # Component library
â”‚   â”œâ”€â”€ framer-motion                # Animations
â”‚   â””â”€â”€ lucide-react                 # Icons
â”‚
â”œâ”€â”€ State & Data
â”‚   â”œâ”€â”€ zustand                      # State management
â”‚   â”œâ”€â”€ @tanstack/react-query        # Server state
â”‚   â””â”€â”€ zod                          # Validation
â”‚
â”œâ”€â”€ Real-time & Media
â”‚   â”œâ”€â”€ socket.io-client             # WebSocket
â”‚   â”œâ”€â”€ simple-peer                  # WebRTC wrapper
â”‚   â”œâ”€â”€ react-webcam                 # Camera access
â”‚   â””â”€â”€ fabric (or konva)            # Canvas for patterns
â”‚
â””â”€â”€ AI Integration
    â””â”€â”€ @google/generative-ai        # Gemini (for client-side quick tasks)
```

### Backend - Node.js (Express + TypeScript)

```
Dependencies:
â”œâ”€â”€ Core (Existing)
â”‚   â”œâ”€â”€ express                      # Web framework
â”‚   â”œâ”€â”€ typescript                   # Type safety
â”‚   â”œâ”€â”€ mongoose                     # MongoDB ODM
â”‚   â”œâ”€â”€ jsonwebtoken                 # JWT auth
â”‚   â”œâ”€â”€ bcryptjs                     # Password hashing
â”‚   â”œâ”€â”€ zod                          # Validation
â”‚   â””â”€â”€ cookie-parser                # Cookie handling
â”‚
â”œâ”€â”€ Real-time (New)
â”‚   â”œâ”€â”€ socket.io                    # WebSocket server
â”‚   â”œâ”€â”€ peer                         # PeerJS server (optional)
â”‚   â””â”€â”€ ioredis                      # Redis client
â”‚
â”œâ”€â”€ AI Integration (New)
â”‚   â”œâ”€â”€ @google/generative-ai        # Gemini SDK
â”‚   â”œâ”€â”€ openai                       # GPT SDK
â”‚   â””â”€â”€ bullmq                       # Job queue for AI tasks
â”‚
â””â”€â”€ Utilities (Existing + New)
    â”œâ”€â”€ cloudinary                   # Image storage
    â”œâ”€â”€ nodemailer                   # Email
    â”œâ”€â”€ multer                       # File uploads
    â””â”€â”€ helmet                       # Security headers
```

### Backend - Python (FastAPI + LangChain)

```
Dependencies:
â”œâ”€â”€ Core
â”‚   â”œâ”€â”€ fastapi                      # Web framework
â”‚   â”œâ”€â”€ uvicorn[standard]            # ASGI server
â”‚   â”œâ”€â”€ pydantic                     # Data validation
â”‚   â””â”€â”€ python-dotenv                # Environment
â”‚
â”œâ”€â”€ AI/ML
â”‚   â”œâ”€â”€ langchain                    # Agent framework
â”‚   â”œâ”€â”€ langchain-google-genai       # Gemini integration
â”‚   â”œâ”€â”€ langchain-openai             # GPT integration
â”‚   â”œâ”€â”€ langgraph                    # Complex workflows
â”‚   â””â”€â”€ langchain-community          # Tools & utilities
â”‚
â”œâ”€â”€ Computer Vision
â”‚   â”œâ”€â”€ mediapipe                    # Face/gesture detection
â”‚   â”œâ”€â”€ opencv-python                # Image processing
â”‚   â””â”€â”€ pillow                       # Image handling
â”‚
â”œâ”€â”€ Real-time
â”‚   â”œâ”€â”€ python-socketio              # WebSocket
â”‚   â””â”€â”€ websockets                   # WS client
â”‚
â””â”€â”€ Storage
    â”œâ”€â”€ redis                        # Session/cache
    â”œâ”€â”€ motor                        # Async MongoDB
    â””â”€â”€ chromadb (optional)          # Vector store
```

### Database & Infrastructure

```
â”œâ”€â”€ MongoDB                          # Primary database
â”‚   â”œâ”€â”€ Users, Contacts, Relationships
â”‚   â”œâ”€â”€ Patterns, Emotion Messages
â”‚   â”œâ”€â”€ Call History, Avatar Profiles
â”‚   â””â”€â”€ Interaction Logs
â”‚
â”œâ”€â”€ Redis                            # Cache & Real-time
â”‚   â”œâ”€â”€ Session storage
â”‚   â”œâ”€â”€ LangChain memory (short-term)
â”‚   â”œâ”€â”€ Socket.io adapter
â”‚   â””â”€â”€ Rate limiting
â”‚
â”œâ”€â”€ Cloudinary                       # Media storage
â”‚   â”œâ”€â”€ Pattern images
â”‚   â””â”€â”€ Profile pictures
â”‚
â””â”€â”€ (Optional) ChromaDB/Pinecone     # Vector database
    â””â”€â”€ Emotion embeddings for search
```

---

## Unified Folder Architecture

```
HackDay/
â”‚
â”œâ”€â”€ ğŸ“ Client/                              # NEXT.JS FRONTEND
â”‚   â”œâ”€â”€ ğŸ“ app/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ (auth)/                      # Auth routes (login, register)
â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ register/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ (main)/                      # Protected routes
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx                # Home, contacts, recent
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ call/                    # FEATURE 1: Video Calls
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx                # Call list/history
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [callId]/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx            # Active call page
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ patterns/                # FEATURE 2: Patterns
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx                # Pattern library
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ create/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx            # Pattern creator
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [patternId]/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx            # Pattern detail
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ chat/                    # FEATURE 3: Emotion Chat
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx                # Conversation list
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [conversationId]/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx            # Chat room
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ avatar/                  # FEATURE 4: Personal Avatar
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx                # Avatar dashboard
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ settings/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx            # Avatar preferences
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ contacts/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx                # Manage contacts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx                  # Main layout with nav
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ api/                         # Next.js API Routes (BFF)
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [...nextauth]/route.ts  # Or custom auth proxy
â”‚   â”‚   â”‚   â””â”€â”€ ai/
â”‚   â”‚   â”‚       â””â”€â”€ quick-emotion/route.ts  # Quick client-side AI calls
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ layout.tsx                      # Root layout
â”‚   â”‚   â”œâ”€â”€ page.tsx                        # Landing page
â”‚   â”‚   â””â”€â”€ globals.css
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ components/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ ui/                          # shadcn/ui components
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ layout/                      # Layout components
â”‚   â”‚   â”‚   â”œâ”€â”€ Navbar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â””â”€â”€ MobileNav.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ video-call/                  # FEATURE 1 Components
â”‚   â”‚   â”‚   â”œâ”€â”€ VideoStream.tsx             # WebRTC video display
â”‚   â”‚   â”‚   â”œâ”€â”€ CallControls.tsx            # Mute, end, etc.
â”‚   â”‚   â”‚   â”œâ”€â”€ EmotionOverlay.tsx          # Shows emotion text
â”‚   â”‚   â”‚   â”œâ”€â”€ IncomingCallModal.tsx       # Accept/reject
â”‚   â”‚   â”‚   â””â”€â”€ CallInviteButton.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ pattern/                     # FEATURE 2 Components
â”‚   â”‚   â”‚   â”œâ”€â”€ PatternCanvas.tsx           # Drawing canvas
â”‚   â”‚   â”‚   â”œâ”€â”€ PatternToolbar.tsx          # Tools, colors
â”‚   â”‚   â”‚   â”œâ”€â”€ PatternCard.tsx             # Display pattern
â”‚   â”‚   â”‚   â”œâ”€â”€ PatternPicker.tsx           # Select from library
â”‚   â”‚   â”‚   â””â”€â”€ EmotionAssociator.tsx       # Link emotion to pattern
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ emotion-chat/                # FEATURE 3 Components
â”‚   â”‚   â”‚   â”œâ”€â”€ EmotionComposer.tsx         # Main emotion selector
â”‚   â”‚   â”‚   â”œâ”€â”€ EmotionPicker.tsx           # Emotion grid
â”‚   â”‚   â”‚   â”œâ”€â”€ IntensitySlider.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ EmotionLayerAdder.tsx       # Secondary emotions
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageBubble.tsx           # Chat message display
â”‚   â”‚   â”‚   â”œâ”€â”€ EmotionGradient.tsx         # Visual gradient
â”‚   â”‚   â”‚   â””â”€â”€ ReactionButtons.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ avatar/                      # FEATURE 4 Components
â”‚   â”‚   â”‚   â”œâ”€â”€ AvatarChat.tsx              # Avatar conversation
â”‚   â”‚   â”‚   â”œâ”€â”€ SuggestionCard.tsx          # Avatar suggestions
â”‚   â”‚   â”‚   â”œâ”€â”€ EmotionAssist.tsx           # Help picking emotion
â”‚   â”‚   â”‚   â”œâ”€â”€ RelationshipInsight.tsx
â”‚   â”‚   â”‚   â””â”€â”€ AvatarSettings.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ shared/                      # Shared components
â”‚   â”‚       â”œâ”€â”€ EmotionBadge.tsx
â”‚   â”‚       â”œâ”€â”€ UserAvatar.tsx
â”‚   â”‚       â”œâ”€â”€ LoadingSpinner.tsx
â”‚   â”‚       â””â”€â”€ ErrorBoundary.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ hooks/
â”‚   â”‚   â”œâ”€â”€ useAuth.ts                      # Auth state
â”‚   â”‚   â”œâ”€â”€ useSocket.ts                    # Socket.io connection
â”‚   â”‚   â”œâ”€â”€ useWebRTC.ts                    # WebRTC logic
â”‚   â”‚   â”œâ”€â”€ useEmotionCapture.ts            # Screenshot capture
â”‚   â”‚   â”œâ”€â”€ usePatternCanvas.ts             # Canvas drawing
â”‚   â”‚   â”œâ”€â”€ useEmotionComposer.ts           # Emotion selection state
â”‚   â”‚   â””â”€â”€ useAvatar.ts                    # Avatar interactions
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ lib/
â”‚   â”‚   â”œâ”€â”€ socket.ts                       # Socket.io client setup
â”‚   â”‚   â”œâ”€â”€ peer.ts                         # WebRTC peer setup
â”‚   â”‚   â”œâ”€â”€ api.ts                          # API client (axios/fetch)
â”‚   â”‚   â”œâ”€â”€ gemini.ts                       # Gemini client
â”‚   â”‚   â””â”€â”€ utils.ts                        # Utilities
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ store/                           # Zustand stores
â”‚   â”‚   â”œâ”€â”€ authStore.ts
â”‚   â”‚   â”œâ”€â”€ callStore.ts
â”‚   â”‚   â”œâ”€â”€ chatStore.ts
â”‚   â”‚   â””â”€â”€ avatarStore.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ types/
â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”œâ”€â”€ call.ts
â”‚   â”‚   â”œâ”€â”€ pattern.ts
â”‚   â”‚   â”œâ”€â”€ emotion.ts
â”‚   â”‚   â””â”€â”€ avatar.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ next.config.js
â”‚
â”‚
â”œâ”€â”€ ğŸ“ Server/                              # NODE.JS BACKEND
â”‚   â”œâ”€â”€ ğŸ“ src/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ config/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.ts                # Environment config
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ modules/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ Auth/                # (Existing)
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.validation.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ auth.utils.ts
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ User/                # (Existing)
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user.controller.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user.route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user.service.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user.model.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ user.interface.ts
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ Contact/             # NEW: Contacts/Friends
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contact.controller.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contact.route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contact.service.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contact.model.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ contact.interface.ts
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ Call/                # NEW: FEATURE 1
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ call.controller.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ call.route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ call.service.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ call.model.ts       # Call sessions
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ call.interface.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ emotionLog.model.ts # Emotion detections
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ Pattern/             # NEW: FEATURE 2
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ pattern.controller.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ pattern.route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ pattern.service.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ pattern.model.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ pattern.interface.ts
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ Chat/                # NEW: FEATURE 3
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ chat.controller.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ chat.route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ chat.service.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ conversation.model.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ emotionMessage.model.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ chat.interface.ts
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ Avatar/              # NEW: FEATURE 4
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ avatar.controller.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ avatar.route.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ avatar.service.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ avatarProfile.model.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ avatarInteraction.model.ts
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ avatar.interface.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ socket/                  # NEW: WebSocket handlers
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts                # Socket.io setup
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ callHandlers.ts         # Call signaling
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ chatHandlers.ts         # Chat real-time
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ emotionHandlers.ts      # Emotion frame routing
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ services/                # NEW: External services
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ gemini.service.ts       # Gemini API wrapper
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ openai.service.ts       # GPT API wrapper
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ aiRouter.service.ts     # Routes to best AI
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ pythonAI.service.ts     # Calls Python service
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ middlewares/             # (Existing + New)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts                 # JWT auth
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ validateRequest.ts      # Zod validation
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ globalErrorHandler.ts   # Error handling
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ notFound.ts             # 404 handler
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ rateLimit.ts            # NEW: Rate limiting
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ utils/                   # (Existing + New)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ catchAsync.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sendResponse.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ verifyJWT.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ emailSender.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ deleteImage.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ emotionColors.ts        # NEW: Emotion-to-color mapping
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ routes/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.ts                # Route aggregator
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ interfaces/
â”‚   â”‚   â”‚       â”œâ”€â”€ error.interface.ts
â”‚   â”‚   â”‚       â””â”€â”€ index.d.ts              # Express augmentation
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ app.ts                          # Express app setup
â”‚   â”‚   â””â”€â”€ server.ts                       # Entry point + Socket.io init
â”‚   â”‚
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ .env
â”‚
â”‚
â”œâ”€â”€ ğŸ“ AI-Service/                          # PYTHON FASTAPI SERVICE
â”‚   â”œâ”€â”€ ğŸ“ app/
â”‚   â”‚   â”œâ”€â”€ main.py                         # FastAPI entry point
â”‚   â”‚   â”œâ”€â”€ config.py                       # Environment config
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ v1/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ emotion_routes.py       # Emotion detection endpoints
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ pattern_routes.py       # Pattern analysis endpoints
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ chat_routes.py          # Text generation endpoints
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ avatar_routes.py        # Avatar AI endpoints
â”‚   â”‚   â”‚   â””â”€â”€ router.py                   # Route aggregator
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ gemini_service.py           # Gemini API wrapper
â”‚   â”‚   â”‚   â”œâ”€â”€ openai_service.py           # OpenAI GPT wrapper
â”‚   â”‚   â”‚   â”œâ”€â”€ emotion_detector.py         # MediaPipe face analysis
â”‚   â”‚   â”‚   â”œâ”€â”€ pattern_analyzer.py         # Pattern feature extraction
â”‚   â”‚   â”‚   â””â”€â”€ avatar_agent.py             # LangChain avatar agent
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ agents/                      # LangChain Agents
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ emotion_translator.py       # Emotion â†’ Text agent
â”‚   â”‚   â”‚   â”œâ”€â”€ pattern_interpreter.py      # Pattern â†’ Meaning agent
â”‚   â”‚   â”‚   â””â”€â”€ avatar_companion.py         # Personal avatar agent
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ chains/                      # LangChain Chains
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ emotion_chain.py            # Emotion analysis chain
â”‚   â”‚   â”‚   â”œâ”€â”€ text_generation_chain.py    # Generate message text
â”‚   â”‚   â”‚   â””â”€â”€ profile_builder_chain.py    # Build user avatar profile
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ memory/                      # LangChain Memory
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ redis_memory.py             # Redis-backed memory
â”‚   â”‚   â”‚   â””â”€â”€ conversation_memory.py      # Conversation context
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ models/                      # Pydantic Models
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ emotion.py                  # Emotion data models
â”‚   â”‚   â”‚   â”œâ”€â”€ pattern.py                  # Pattern data models
â”‚   â”‚   â”‚   â”œâ”€â”€ message.py                  # Chat message models
â”‚   â”‚   â”‚   â””â”€â”€ avatar.py                   # Avatar profile models
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ image_processing.py         # Image utilities
â”‚   â”‚   â”‚   â”œâ”€â”€ mediapipe_utils.py          # MediaPipe helpers
â”‚   â”‚   â”‚   â””â”€â”€ prompts.py                  # System prompts
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ websocket/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ handlers.py                 # WebSocket event handlers
â”‚   â”‚
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ .env
â”‚
â”‚
â””â”€â”€ ğŸ“ shared/                              # SHARED RESOURCES
    â”œâ”€â”€ ğŸ“ types/                           # Shared TypeScript types
    â”‚   â”œâ”€â”€ emotion.ts
    â”‚   â”œâ”€â”€ pattern.ts
    â”‚   â””â”€â”€ socket-events.ts
    â”‚
    â””â”€â”€ ğŸ“ constants/
        â”œâ”€â”€ emotions.json                   # Emotion definitions
        â””â”€â”€ colors.json                     # Emotion color mappings
```

---

## API Flow Examples

### Video Call Emotion Flow

```
1. User A captures frame â†’ sends via Socket.io
2. Node.js Server â†’ forwards to Python AI Service
3. Python: MediaPipe extracts face features
4. Python: Gemini analyzes emotions
5. Python: Returns emotion text
6. Node.js â†’ broadcasts to User B via Socket.io
7. User B sees: "Your friend seems thoughtful and mildly concerned"
```

### Emotion Chat Message Flow

```
1. User selects: grateful (35%) + nostalgic (20%)
2. Frontend â†’ POST /api/v1/chat/:convId/messages
3. Node.js â†’ calls Python AI Service
4. Python: GPT-4o generates personalized text
5. Node.js â†’ stores message, emits via Socket.io
6. Recipient sees rich emotion message with gradient
```

---

## Environment Variables

### Node.js Server (.env)

```env
# Existing
NODE_ENV=development
PORT=5000
DATABASE_URL=mongodb://localhost:27017/heartspeak
JWT_ACCESS_SECRET=your_access_secret
JWT_REFRESH_SECRET=your_refresh_secret
JWT_ACCESS_EXPIRES_IN=1d
JWT_REFRESH_EXPIRES_IN=365d
BCRYPT_SALT_ROUNDS=12
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret

# New for HeartSpeak
GEMINI_API_KEY=your_gemini_api_key
OPENAI_API_KEY=your_openai_api_key
PYTHON_AI_SERVICE_URL=http://localhost:8000
REDIS_URL=redis://localhost:6379
```

### Python AI Service (.env)

```env
GEMINI_API_KEY=your_gemini_api_key
OPENAI_API_KEY=your_openai_api_key
MONGODB_URL=mongodb://localhost:27017/heartspeak
REDIS_URL=redis://localhost:6379
NODE_SERVER_URL=http://localhost:5000
```

---

## Socket.io Events

### Call Events

| Event | Direction | Payload | Description |
|-------|-----------|---------|-------------|
| `call:initiate` | Client â†’ Server | `{ recipientId }` | Start a call |
| `call:incoming` | Server â†’ Client | `{ callId, caller }` | Notify recipient |
| `call:accept` | Client â†’ Server | `{ callId }` | Accept call |
| `call:reject` | Client â†’ Server | `{ callId }` | Reject call |
| `call:signal` | Bidirectional | `{ signal, callId }` | WebRTC signaling |
| `call:emotion` | Server â†’ Client | `{ text, emotion }` | Emotion analysis result |
| `call:end` | Bidirectional | `{ callId }` | End call |

### Chat Events

| Event | Direction | Payload | Description |
|-------|-----------|---------|-------------|
| `chat:message` | Server â†’ Client | `{ message }` | New emotion message |
| `chat:typing` | Bidirectional | `{ convId, userId }` | Typing indicator |
| `chat:reaction` | Bidirectional | `{ messageId, reaction }` | Message reaction |

### Avatar Events

| Event | Direction | Payload | Description |
|-------|-----------|---------|-------------|
| `avatar:suggestion` | Server â†’ Client | `{ suggestion }` | Proactive suggestion |
| `avatar:insight` | Server â†’ Client | `{ insight }` | Relationship insight |

---

## Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              PRODUCTION SETUP                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   Cloudflare    â”‚
                              â”‚   (CDN/DNS)     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                  â”‚                  â”‚
                    â–¼                  â–¼                  â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   Vercel    â”‚    â”‚   Railway   â”‚    â”‚   Railway   â”‚
           â”‚  (Next.js)  â”‚    â”‚  (Node.js)  â”‚    â”‚  (Python)   â”‚
           â”‚   Client    â”‚    â”‚   Server    â”‚    â”‚  AI Service â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚                â”‚                  â”‚
                    â–¼                â–¼                  â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  MongoDB    â”‚    â”‚    Redis    â”‚    â”‚ Cloudinary  â”‚
           â”‚   Atlas     â”‚    â”‚   (Upstash) â”‚    â”‚   (Media)   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Development Commands

### Node.js Server

```bash
cd Server
npm install
npm run dev        # Development with hot reload
npm run build      # Build for production
npm start          # Start production server
```

### Python AI Service

```bash
cd AI-Service
python -m venv venv
source venv/bin/activate  # or `venv\Scripts\activate` on Windows
pip install -r requirements.txt
uvicorn app.main:app --reload --port 8000
```

### Next.js Client

```bash
cd Client
npm install
npm run dev        # Development server (port 3000)
npm run build      # Production build
npm start          # Start production server
```

---

## Next Steps

1. **Phase 1**: Implement backend modules in Node.js Server
2. **Phase 2**: Set up Python AI Service with LangChain
3. **Phase 3**: Initialize and build Next.js frontend
4. **Phase 4**: Integrate all components with Socket.io
5. **Phase 5**: Testing and optimization
6. **Phase 6**: Deployment to production

---

## Contributing

When adding new features:

1. Follow the modular architecture pattern
2. Add proper TypeScript types
3. Include Zod validation for all inputs
4. Write API documentation
5. Test Socket.io events manually
6. Consider both AI providers (Gemini/GPT) for each feature

---

*This document serves as the complete architectural blueprint for HeartSpeak AI. Refer to this when implementing any feature.*